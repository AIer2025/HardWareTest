# RÂ²å›ºå®šä¸º0.95é—®é¢˜ - ä¿®å¤æ–¹æ¡ˆå¯¹æ¯”ä¸åº”ç”¨æŒ‡å—

## ğŸ¯ é—®é¢˜å¿«é€Ÿå®šä½

**ç—‡çŠ¶**ï¼šå¨å¸ƒå°”åˆ†æç•Œé¢ä¸­ï¼Œæ‹Ÿåˆä¼˜åº¦ RÂ² å§‹ç»ˆæ˜¾ç¤º 0.9500ï¼Œåˆ‡æ¢ä¸åŒæ¨¡ç»„ä¹Ÿä¸æ”¹å˜

**åŸå› **ï¼š`WeibullAnalysisViewModel.cs` ä¸­çš„ `CalculateRSquared` æ–¹æ³•è¿”å›ç¡¬ç¼–ç çš„ 0.95

**ä½ç½®**ï¼šç¬¬688-708è¡Œï¼Œç¬¬701è¡Œ `return 0.95;`

---

## ğŸ“Š ä¸¤ç§ä¿®å¤æ–¹æ¡ˆå¯¹æ¯”

| å¯¹æ¯”é¡¹ | æ–¹æ¡ˆ1ï¼šå®Œæ•´ä¿®å¤ â­ | æ–¹æ¡ˆ2ï¼šå¿«é€Ÿä¿®å¤ |
|-------|-------------------|----------------|
| **æ”¹åŠ¨èŒƒå›´** | 3ä¸ªæ–‡ä»¶ | 1ä¸ªæ–‡ä»¶ï¼ˆ1ä¸ªæ–¹æ³•ï¼‰ |
| **ä»£ç è¡Œæ•°** | ~100è¡Œ | ~50è¡Œ |
| **ä¿®å¤æ—¶é—´** | 15-20åˆ†é’Ÿ | 5åˆ†é’Ÿ |
| **å½»åº•æ€§** | â­â­â­â­â­ | â­â­â­ |
| **ç»´æŠ¤æ€§** | â­â­â­â­â­ | â­â­ |
| **ä»£ç è´¨é‡** | â­â­â­â­â­ | â­â­â­ |
| **ç»Ÿä¸€æ€§** | âœ… ç»Ÿä¸€ä½¿ç”¨Engine | âš ï¸ åˆ†æ•£çš„é€»è¾‘ |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­ |

---

## æ–¹æ¡ˆ1ï¼šå®Œæ•´ä¿®å¤ï¼ˆæ¨èï¼‰â­

### ä¼˜ç‚¹
âœ… **å½»åº•è§£å†³**ï¼šä½¿ç”¨å·²ä¿®å¤çš„ WeibullEngine  
âœ… **å®Œæ•´ç»“æœ**ï¼šè·å¾—æ‰€æœ‰åˆ†ææŒ‡æ ‡ï¼ˆåŒ…æ‹¬æ­£ç¡®çš„RÂ²ï¼‰  
âœ… **é¿å…é‡å¤**ï¼šç»Ÿä¸€åˆ†æé€»è¾‘ï¼Œå‡å°‘ä»£ç é‡å¤  
âœ… **æ˜“äºç»´æŠ¤**ï¼šå•ä¸€èŒè´£ï¼Œä¾¿äºæœªæ¥ä¿®æ”¹  
âœ… **è´¨é‡ä¿è¯**ï¼šä¸MATLABæ ‡å‡†æ–¹æ³•å®Œå…¨ä¸€è‡´  

### ç¼ºç‚¹
âš ï¸ éœ€è¦ä¿®æ”¹3ä¸ªæ–‡ä»¶  
âš ï¸ æ”¹åŠ¨ç›¸å¯¹è¾ƒå¤§  

### ä¿®æ”¹æ–‡ä»¶æ¸…å•
```
1. src/LabTestPlatform.Core/Services/IWeibullAnalysisService.cs
   æ·»åŠ ï¼šAnalyzeWithEngine æ–¹æ³•æ¥å£

2. src/LabTestPlatform.Core/Services/WeibullAnalysisService.cs
   æ·»åŠ ï¼šAnalyzeWithEngine æ–¹æ³•å®ç°

3. src/LabTestPlatform.UI/ViewModels/WeibullAnalysisViewModel.cs
   ä¿®æ”¹ï¼šAnalyze æ–¹æ³•ï¼ˆç¬¬474-600è¡Œï¼‰
   åˆ é™¤ï¼šCalculateRSquared æ–¹æ³•ï¼ˆå¯é€‰ï¼‰
```

### æ ¸å¿ƒæ€è·¯
```
æ—§æµç¨‹ï¼ˆé”™è¯¯ï¼‰ï¼š
ViewModel.Analyze()
  â”œâ”€ Service.CalculateWeibullParameters() â†’ åªå¾—åˆ° Î², Î·
  â””â”€ ViewModel.CalculateRSquared()        â†’ è¿”å› 0.95 âŒ

æ–°æµç¨‹ï¼ˆæ­£ç¡®ï¼‰ï¼š
ViewModel.Analyze()
  â””â”€ Service.AnalyzeWithEngine()
       â””â”€ WeibullEngine.Analyze()        â†’ å¾—åˆ°å®Œæ•´ç»“æœ âœ…
            â”œâ”€ Î²
            â”œâ”€ Î·
            â”œâ”€ RÂ² ï¼ˆæ­£ç¡®è®¡ç®—ï¼‰
            â”œâ”€ MTTF
            â”œâ”€ B10/B50/B90
            â””â”€ ç½®ä¿¡åŒºé—´
```

---

## æ–¹æ¡ˆ2ï¼šå¿«é€Ÿä¿®å¤

### ä¼˜ç‚¹
âœ… **æ”¹åŠ¨æœ€å°**ï¼šåªéœ€ä¿®æ”¹1ä¸ªæ–¹æ³•  
âœ… **å¿«é€Ÿè§£å†³**ï¼š5åˆ†é’Ÿå³å¯å®Œæˆ  
âœ… **é£é™©è¾ƒä½**ï¼šå½±å“èŒƒå›´å°  

### ç¼ºç‚¹
âš ï¸ **é‡å¤ä»£ç **ï¼šViewModel å’Œ Engine éƒ½æœ‰RÂ²è®¡ç®—  
âš ï¸ **ç»´æŠ¤å›°éš¾**ï¼šä¸¤å¤„éœ€è¦åŒæ­¥ç»´æŠ¤  
âš ï¸ **ä¸å¤Ÿä¼˜é›…**ï¼šæ²¡æœ‰å……åˆ†åˆ©ç”¨å·²æœ‰çš„Engine  

### ä¿®æ”¹æ–‡ä»¶
```
åªéœ€ä¿®æ”¹ï¼šsrc/LabTestPlatform.UI/ViewModels/WeibullAnalysisViewModel.cs
         ç¬¬688-708è¡Œçš„ CalculateRSquared æ–¹æ³•
```

### æ ¸å¿ƒä¿®å¤
```csharp
// åŸä»£ç ï¼ˆé”™è¯¯ï¼‰
private double CalculateRSquared(double[] failures)
{
    // ...
    return 0.95;  // âŒ ç¡¬ç¼–ç 
}

// ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰
private double CalculateRSquared(double[] failures)
{
    // ...è®¡ç®—Pearsonç›¸å…³ç³»æ•°...
    double r = sumXY / Math.Sqrt(sumXX * sumYY);
    return r * r;  // âœ… æ­£ç¡®è®¡ç®—
}
```

---

## ğŸš€ åº”ç”¨æŒ‡å—

### æ–¹æ¡ˆ1åº”ç”¨æ­¥éª¤ï¼ˆæ¨èï¼‰

#### æ­¥éª¤1ï¼šä¿®æ”¹ IWeibullAnalysisService.cs
```csharp
// åœ¨æ¥å£ä¸­æ·»åŠ æ–°æ–¹æ³•
WeibullResult AnalyzeWithEngine(double[] failureTimes, bool[] isCensored, 
                                 double confidenceLevel = 0.95);
```

#### æ­¥éª¤2ï¼šä¿®æ”¹ WeibullAnalysisService.cs
```csharp
// åœ¨ç±»ä¸­å®ç°æ–°æ–¹æ³•
public WeibullResult AnalyzeWithEngine(double[] failureTimes, bool[] isCensored, 
                                       double confidenceLevel = 0.95)
{
    if (failureTimes == null || failureTimes.Length == 0)
        throw new ArgumentException("å¤±æ•ˆæ—¶é—´æ•°æ®ä¸èƒ½ä¸ºç©º");
    
    isCensored ??= new bool[failureTimes.Length];
    
    return _weibullEngine.Analyze(failureTimes, isCensored, confidenceLevel);
}
```

#### æ­¥éª¤3ï¼šä¿®æ”¹ WeibullAnalysisViewModel.cs

**æ›¿æ¢ Analyze æ–¹æ³•çš„æ ¸å¿ƒéƒ¨åˆ†**ï¼š

```csharp
// å‡†å¤‡æ•°æ®
double[] allTimes = new double[TestData.Count];
bool[] isCensored = new bool[TestData.Count];

for (int i = 0; i < TestData.Count; i++)
{
    allTimes[i] = TestData[i].Time;
    isCensored[i] = !TestData[i].IsFailure;
}

// âœ… è°ƒç”¨å®Œæ•´åˆ†æ
var result = _analysisService.AnalyzeWithEngine(allTimes, isCensored, 0.95);

// âœ… è®¾ç½®æ‰€æœ‰ç»“æœ
Beta = result.Beta;
Eta = result.Eta;
RSquared = result.RSquared;  // â† æ­£ç¡®çš„RÂ²
MTTF = result.MTTF;
B10Life = result.B10Life;
B50Life = result.B50Life;
B90Life = result.B90Life;

// ç½®ä¿¡åŒºé—´
if (failureCount >= 10)
{
    BetaLowerBound = result.BetaLower;
    BetaUpperBound = result.BetaUpper;
    EtaLowerBound = result.EtaLower;
    EtaUpperBound = result.EtaUpper;
}
```

#### æ­¥éª¤4ï¼šç¼–è¯‘æµ‹è¯•
```bash
dotnet build
dotnet run
```

---

### æ–¹æ¡ˆ2åº”ç”¨æ­¥éª¤

#### æ­¥éª¤1ï¼šä¿®æ”¹ WeibullAnalysisViewModel.cs

æ‰¾åˆ°ç¬¬688-708è¡Œçš„ `CalculateRSquared` æ–¹æ³•ï¼Œå®Œæ•´æ›¿æ¢ä¸ºï¼š

```csharp
private double CalculateRSquared(double[] failures)
{
    try
    {
        if (failures.Length < 2) return 0;
        
        var sorted = failures.OrderBy(t => t).ToArray();
        int n = sorted.Length;
        
        // å‡†å¤‡çº¿æ€§åŒ–æ•°æ®
        double[] x = new double[n];
        double[] y = new double[n];
        
        for (int i = 0; i < n; i++)
        {
            double rank = i + 1;
            double F = (rank - 0.3) / (n + 0.4);
            x[i] = Math.Log(sorted[i]);
            y[i] = Math.Log(-Math.Log(1 - F));
        }
        
        // è®¡ç®—Pearsonç›¸å…³ç³»æ•°
        double xMean = x.Average();
        double yMean = y.Average();
        
        double sumXY = 0, sumXX = 0, sumYY = 0;
        for (int i = 0; i < n; i++)
        {
            double dx = x[i] - xMean;
            double dy = y[i] - yMean;
            sumXY += dx * dy;
            sumXX += dx * dx;
            sumYY += dy * dy;
        }
        
        if (sumXX == 0 || sumYY == 0) return 0;
        
        double r = sumXY / Math.Sqrt(sumXX * sumYY);
        double rSquared = r * r;
        
        if (double.IsNaN(rSquared) || double.IsInfinity(rSquared))
            return 0;
        
        return rSquared;
    }
    catch (Exception ex)
    {
        SimpleLogger.Error("è®¡ç®—RÂ²æ—¶å‘ç”Ÿé”™è¯¯", ex);
        return 0;
    }
}
```

#### æ­¥éª¤2ï¼šç¼–è¯‘æµ‹è¯•
```bash
dotnet build
dotnet run
```

---

## âœ… éªŒè¯ä¿®å¤æ•ˆæœ

ä¿®å¤åï¼Œæ‰§è¡Œä»¥ä¸‹éªŒè¯ï¼š

### 1. åŠŸèƒ½éªŒè¯
- [ ] é€‰æ‹©ä¸åŒæ¨¡ç»„è¿›è¡Œåˆ†æ
- [ ] æ£€æŸ¥RÂ²å€¼æ˜¯å¦å˜åŒ–
- [ ] ç¡®è®¤RÂ²å€¼åœ¨åˆç†èŒƒå›´ï¼ˆ0-1ï¼‰

### 2. æ•°å€¼éªŒè¯
```
é¢„æœŸç»“æœï¼š
- ä¼˜ç§€æ‹Ÿåˆ: RÂ² > 0.95
- è‰¯å¥½æ‹Ÿåˆ: 0.90 < RÂ² < 0.95
- ä¸€èˆ¬æ‹Ÿåˆ: 0.85 < RÂ² < 0.90
```

### 3. å¯¹æ¯”éªŒè¯
å¦‚æœæœ‰MATLABå‚è€ƒæ•°æ®ï¼š
- [ ] å¯¹æ¯”Î²å€¼ï¼ˆåº”ä¸€è‡´ï¼‰
- [ ] å¯¹æ¯”Î·å€¼ï¼ˆåº”ä¸€è‡´ï¼‰
- [ ] å¯¹æ¯”RÂ²å€¼ï¼ˆåº”ä¸€è‡´ï¼‰

---

## ğŸ“‹ ä¿®å¤æ£€æŸ¥æ¸…å•

### ä¿®å¤å‰
- [ ] å¤‡ä»½åŸä»£ç 
- [ ] è®°å½•å½“å‰RÂ²å€¼ï¼ˆåº”è¯¥æ˜¯0.95ï¼‰
- [ ] å‡†å¤‡æµ‹è¯•æ•°æ®

### ä¿®å¤ä¸­
- [ ] é€‰æ‹©ä¿®å¤æ–¹æ¡ˆ
- [ ] æŒ‰æ­¥éª¤ä¿®æ”¹ä»£ç 
- [ ] ç¼–è¯‘é€šè¿‡

### ä¿®å¤å
- [ ] RÂ²å€¼ä¼šå˜åŒ–
- [ ] ä¸åŒæ¨¡ç»„RÂ²ä¸åŒ
- [ ] æ•°å€¼åœ¨åˆç†èŒƒå›´
- [ ] å…¶ä»–å‚æ•°æ­£å¸¸ï¼ˆÎ²ã€Î·ç­‰ï¼‰

---

## ğŸ¯ æ¨èå†³ç­–

### é€‰æ‹©æ–¹æ¡ˆ1ï¼ˆå®Œæ•´ä¿®å¤ï¼‰ï¼Œå¦‚æœï¼š
- âœ… è¿½æ±‚ä»£ç è´¨é‡
- âœ… é•¿æœŸç»´æŠ¤é¡¹ç›®
- âœ… æœ‰å……è¶³æ—¶é—´ï¼ˆ15-20åˆ†é’Ÿï¼‰
- âœ… å¸Œæœ›å½»åº•è§£å†³é—®é¢˜

### é€‰æ‹©æ–¹æ¡ˆ2ï¼ˆå¿«é€Ÿä¿®å¤ï¼‰ï¼Œå¦‚æœï¼š
- âœ… ç´§æ€¥ä¿®å¤
- âœ… æ—¶é—´æœ‰é™ï¼ˆ5åˆ†é’Ÿï¼‰
- âœ… ä¸´æ—¶è§£å†³æ–¹æ¡ˆ
- âœ… åç»­ä¼šé‡æ„

---

## ğŸ’¡ é¢å¤–å»ºè®®

### æœªæ¥ä¼˜åŒ–
1. **æ·»åŠ å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•RÂ²è®¡ç®—çš„æ­£ç¡®æ€§
2. **å‚æ•°éªŒè¯**ï¼šæ·»åŠ è¾“å…¥æ•°æ®éªŒè¯
3. **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„é”™è¯¯æç¤ºä¿¡æ¯
4. **æ—¥å¿—è®°å½•**ï¼šè®°å½•åˆ†æè¿‡ç¨‹è¯¦æƒ…

### ç›¸å…³ä¿®å¤
å¦‚æœè¿˜æ²¡æœ‰åº”ç”¨ä¹‹å‰çš„ **Weibullåˆ†æå¼•æ“ä¿®å¤åŒ…**ï¼Œå»ºè®®ä¸€å¹¶åº”ç”¨ï¼š
- WeibullEngine.cs ä¸­ RÂ² è®¡ç®—çš„ä¿®å¤
- ç¡®ä¿ Engine å’Œ ViewModel çš„ RÂ² è®¡ç®—æ–¹æ³•ä¸€è‡´

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

é‡åˆ°é—®é¢˜æ—¶ï¼š
1. æ£€æŸ¥ç¼–è¯‘é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹è¿è¡Œæ—¶æ—¥å¿—
3. å¯¹æ¯”ä¿®å¤å‰åä»£ç 
4. å‚è€ƒå®Œæ•´ä»£ç æ–‡ä»¶

---

**æœ€åæ›´æ–°**: 2024-11-23  
**é—®é¢˜çº§åˆ«**: ğŸ”´ é«˜  
**æ¨èæ–¹æ¡ˆ**: æ–¹æ¡ˆ1ï¼ˆå®Œæ•´ä¿®å¤ï¼‰â­  
**ä¿®å¤æ—¶é—´**: 15-20åˆ†é’Ÿ  
**éš¾åº¦**: ä¸­ç­‰
