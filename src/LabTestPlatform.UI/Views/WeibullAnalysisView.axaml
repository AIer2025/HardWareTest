<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:LabTestPlatform.UI.ViewModels"
             xmlns:scottplot="clr-namespace:ScottPlot.Avalonia;assembly=ScottPlot.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="LabTestPlatform.UI.Views.WeibullAnalysisView"
             x:DataType="vm:WeibullAnalysisViewModel"
             x:CompileBindings="True">
    
    <Design.DataContext>
        <vm:WeibullAnalysisViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*" Margin="10">
        
        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" 
                Background="#E67E22" 
                Padding="15,10" 
                CornerRadius="5"
                Margin="0,0,0,10">
            <TextBlock Text="å¨å¸ƒå°”å¯é æ€§åˆ†æž" 
                       FontSize="20" 
                       FontWeight="Bold"
                       Foreground="White"/>
        </Border>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <Grid Grid.Row="1" RowDefinitions="Auto,*">
            
            <!-- å‚æ•°é€‰æ‹©åŒºåŸŸ -->
            <Border Grid.Row="0" 
                    Background="White" 
                    BorderBrush="#BDC3C7" 
                    BorderThickness="1" 
                    CornerRadius="5"
                    Padding="20"
                    Margin="0,0,0,10">
                <Grid ColumnDefinitions="*,*,Auto">
                    
                    <!-- é€‰æ‹©ç³»ç»Ÿ -->
                    <StackPanel Grid.Column="0" Spacing="8" Margin="0,0,15,0">
                        <TextBlock Text="é€‰æ‹©ç³»ç»Ÿ" FontWeight="Bold"/>
                        <ComboBox ItemsSource="{Binding Systems}"
                                  SelectedItem="{Binding SelectedSystem}"
                                  PlaceholderText="è¯·é€‰æ‹©ç³»ç»Ÿ"
                                  HorizontalAlignment="Stretch">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding SystemName}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <!-- é€‰æ‹©å¹³å° -->
                    <StackPanel Grid.Column="1" Spacing="8" Margin="0,0,15,0">
                        <TextBlock Text="é€‰æ‹©å¹³å°" FontWeight="Bold"/>
                        <ComboBox ItemsSource="{Binding Platforms}"
                                  SelectedItem="{Binding SelectedPlatform}"
                                  PlaceholderText="è¯·é€‰æ‹©å¹³å°"
                                  IsEnabled="{Binding HasSelectedSystem}"
                                  HorizontalAlignment="Stretch">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding PlatformName}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <!-- é€‰æ‹©æ¨¡ç»„ -->
                    <StackPanel Grid.Column="2" Spacing="8" Width="250">
                        <TextBlock Text="é€‰æ‹©æ¨¡ç»„" FontWeight="Bold"/>
                        <Grid ColumnDefinitions="*,Auto">
                            <ComboBox Grid.Column="0"
                                      ItemsSource="{Binding Modules}"
                                      SelectedItem="{Binding SelectedModule}"
                                      PlaceholderText="è¯·é€‰æ‹©æ¨¡ç»„"
                                      IsEnabled="{Binding HasSelectedPlatform}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding ModuleName}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Grid.Column="1"
                                    Content="åˆ†æž"
                                    Command="{Binding AnalyzeCommand}"
                                    Margin="10,0,0,0"
                                    Padding="15,0"
                                    Background="#E67E22"
                                    Foreground="White"
                                    CornerRadius="3"
                                    IsEnabled="{Binding CanAnalyze}"/>
                        </Grid>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ç»“æžœæ˜¾ç¤ºåŒºåŸŸ -->
            <Grid Grid.Row="1" ColumnDefinitions="2*,3*">
                
                <!-- å·¦ä¾§ï¼šåˆ†æžç»“æžœ -->
                <Border Grid.Column="0" 
                        Background="White" 
                        BorderBrush="#BDC3C7" 
                        BorderThickness="1" 
                        CornerRadius="5"
                        Padding="20"
                        Margin="0,0,10,0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="15" IsVisible="{Binding HasResult}">
                            
                            <TextBlock Text="åˆ†æžç»“æžœ" 
                                       FontWeight="Bold" 
                                       FontSize="18"
                                       Margin="0,0,0,10"/>

                            <!-- åŸºæœ¬ä¿¡æ¯ -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="åŸºæœ¬ä¿¡æ¯" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Foreground="#34495E"/>
                                <Border Background="#ECF0F1" Padding="10" CornerRadius="3">
                                    <StackPanel Spacing="5">
                                        <TextBlock>
                                            <Run Text="æ¨¡ç»„: " Foreground="#7F8C8D"/>
                                            <Run Text="{Binding ResultModuleName}" FontWeight="Bold"/>
                                        </TextBlock>
                                        <TextBlock>
                                            <Run Text="æ ·æœ¬æ•°: " Foreground="#7F8C8D"/>
                                            <Run Text="{Binding SampleCount}" FontWeight="Bold"/>
                                        </TextBlock>
                                        <TextBlock>
                                            <Run Text="åˆ†æžæ—¶é—´: " Foreground="#7F8C8D"/>
                                            <Run Text="{Binding AnalysisTime, StringFormat='yyyy-MM-dd HH:mm:ss'}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- å¨å¸ƒå°”å‚æ•° -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="å¨å¸ƒå°”å‚æ•°" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Foreground="#34495E"/>
                                <Border Background="#E8F8F5" Padding="10" CornerRadius="3">
                                    <StackPanel Spacing="5">
                                        <TextBlock>
                                            <Run Text="å½¢çŠ¶å‚æ•° Î²: " Foreground="#16A085"/>
                                            <Run Text="{Binding Beta, StringFormat='{}{0:F4}'}" 
                                                 FontWeight="Bold" FontSize="16"/>
                                        </TextBlock>
                                        <TextBlock>
                                            <Run Text="å°ºåº¦å‚æ•° Î·: " Foreground="#16A085"/>
                                            <Run Text="{Binding Eta, StringFormat='{}{0:F2}'}" 
                                                 FontWeight="Bold" FontSize="16"/>
                                            <Run Text=" å°æ—¶"/>
                                        </TextBlock>
                                        <TextBlock FontSize="11" Foreground="#7F8C8D" TextWrapping="Wrap"
                                                   Text="Î² &lt; 1: æ—©æœŸå¤±æ•ˆ; Î² = 1: éšæœºå¤±æ•ˆ; Î² > 1: ç£¨æŸå¤±æ•ˆ"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- å¯é æ€§æŒ‡æ ‡ -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="å¯é æ€§æŒ‡æ ‡" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Foreground="#34495E"/>
                                <Border Background="#FEF5E7" Padding="10" CornerRadius="3">
                                    <StackPanel Spacing="5">
                                        <TextBlock>
                                            <Run Text="å¹³å‡å¯¿å‘½ MTTF: " Foreground="#F39C12"/>
                                            <Run Text="{Binding MTTF, StringFormat='{}{0:F2}'}" 
                                                 FontWeight="Bold"/>
                                            <Run Text=" å°æ—¶"/>
                                        </TextBlock>
                                        <TextBlock>
                                            <Run Text="B10 å¯¿å‘½: " Foreground="#E67E22"/>
                                            <Run Text="{Binding B10Life, StringFormat='{}{0:F2}'}" 
                                                 FontWeight="Bold"/>
                                            <Run Text=" å°æ—¶"/>
                                        </TextBlock>
                                        <TextBlock>
                                            <Run Text="B50 å¯¿å‘½: " Foreground="#E67E22"/>
                                            <Run Text="{Binding B50Life, StringFormat='{}{0:F2}'}" 
                                                 FontWeight="Bold"/>
                                            <Run Text=" å°æ—¶"/>
                                        </TextBlock>
                                        <TextBlock>
                                            <Run Text="B90 å¯¿å‘½: " Foreground="#E67E22"/>
                                            <Run Text="{Binding B90Life, StringFormat='{}{0:F2}'}" 
                                                 FontWeight="Bold"/>
                                            <Run Text=" å°æ—¶"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- æ‹Ÿåˆè´¨é‡ -->
                            <StackPanel Spacing="8">
                                <TextBlock Text="æ‹Ÿåˆè´¨é‡" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Foreground="#34495E"/>
                                <Border Background="#FDEDEC" Padding="10" CornerRadius="3">
                                    <StackPanel Spacing="5">
                                        <TextBlock>
                                            <Run Text="æ‹Ÿåˆä¼˜åº¦ RÂ²: " Foreground="#E74C3C"/>
                                            <Run Text="{Binding RSquared, StringFormat='{}{0:F4}'}" 
                                                 FontWeight="Bold" FontSize="16"/>
                                        </TextBlock>
                                        <TextBlock FontSize="11" Foreground="#7F8C8D"
                                                   Text="RÂ² > 0.95 è¡¨ç¤ºæ‹Ÿåˆè‰¯å¥½"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- ç½®ä¿¡åŒºé—´ -->
                            <StackPanel Spacing="8" IsVisible="{Binding HasConfidenceInterval}">
                                <TextBlock Text="ç½®ä¿¡åŒºé—´ (95%)" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Foreground="#34495E"/>
                                <Border Background="#EBF5FB" Padding="10" CornerRadius="3">
                                    <StackPanel Spacing="5">
                                        <TextBlock FontSize="12">
                                            <Run Text="Î²: ["/>
                                            <Run Text="{Binding BetaLower, StringFormat='{}{0:F4}'}"/>
                                            <Run Text=", "/>
                                            <Run Text="{Binding BetaUpper, StringFormat='{}{0:F4}'}"/>
                                            <Run Text="]"/>
                                        </TextBlock>
                                        <TextBlock FontSize="12">
                                            <Run Text="Î·: ["/>
                                            <Run Text="{Binding EtaLower, StringFormat='{}{0:F2}'}"/>
                                            <Run Text=", "/>
                                            <Run Text="{Binding EtaUpper, StringFormat='{}{0:F2}'}"/>
                                            <Run Text="]"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <StackPanel Spacing="10" Margin="0,10,0,0">
                                <Button Content="ä¿å­˜ç»“æžœ" 
                                        Command="{Binding SaveResultCommand}"
                                        HorizontalAlignment="Stretch"
                                        Padding="10"
                                        Background="#27AE60"
                                        Foreground="White"
                                        CornerRadius="3"/>
                                <Button Content="å¯¼å‡ºæŠ¥å‘Š" 
                                        Command="{Binding ExportReportCommand}"
                                        HorizontalAlignment="Stretch"
                                        Padding="10"
                                        Background="#3498DB"
                                        Foreground="White"
                                        CornerRadius="3"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- æ— ç»“æžœæç¤º -->
                        <StackPanel IsVisible="{Binding !HasResult}"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="10">
                            <TextBlock Text="ðŸ“Š" 
                                       FontSize="48"
                                       HorizontalAlignment="Center"
                                       Foreground="#BDC3C7"/>
                            <TextBlock Text="è¯·é€‰æ‹©æ¨¡ç»„å¹¶ç‚¹å‡»åˆ†æžæŒ‰é’®" 
                                       FontSize="14"
                                       Foreground="#7F8C8D"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- å³ä¾§ï¼šå¨å¸ƒå°”å›¾è¡¨ -->
                <Border Grid.Column="1" 
                        Background="White" 
                        BorderBrush="#BDC3C7" 
                        BorderThickness="1" 
                        CornerRadius="5"
                        Padding="20">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top"
                                   Text="å¨å¸ƒå°”æ¦‚çŽ‡å›¾" 
                                   FontWeight="Bold" 
                                   FontSize="16"
                                   Margin="0,0,0,10"/>

                        <!-- ScottPlot å›¾è¡¨ -->
                        <scottplot:AvaPlot x:Name="WeibullPlot" 
                                           IsVisible="{Binding HasResult}"/>

                        <!-- æ— å›¾è¡¨æç¤º -->
                        <StackPanel IsVisible="{Binding !HasResult}"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Spacing="10">
                            <TextBlock Text="ðŸ“ˆ" 
                                       FontSize="64"
                                       HorizontalAlignment="Center"
                                       Foreground="#BDC3C7"/>
                            <TextBlock Text="å¨å¸ƒå°”æ¦‚çŽ‡å›¾å°†åœ¨åˆ†æžåŽæ˜¾ç¤º" 
                                       FontSize="14"
                                       Foreground="#7F8C8D"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
